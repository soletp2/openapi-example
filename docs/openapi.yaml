openapi: 3.0.3
info:
  title: Clothing Store API
  version: 1.1.0
  description: >
    Sample OpenAPI spec for a clothing e-commerce website.
    Includes products, categories, brands, cart, checkout, orders, auth, and payment webhooks.
servers:
  - url: https://api.example.com/v1

tags:
  - name: Auth
  - name: Products
  - name: Catalog
  - name: Cart
  - name: Checkout
  - name: Orders
  - name: Webhooks

paths:
  /auth/login:
    post:
      tags: [Auth]
      summary: Login and get access token
      description: Exchanges credentials for a JWT access token (sample).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
            examples:
              example:
                value:
                  email: "user@example.com"
                  password: "CorrectHorseBatteryStaple!"
      responses:
        "200":
          description: Auth token response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthToken"
              examples:
                example:
                  value:
                    accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    tokenType: "Bearer"
                    expiresIn: 3600
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /products:
    get:
      tags: [Products]
      summary: List products
      description: Returns a paginated list of products with optional filters.
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/Limit"
        - name: q
          in: query
          description: Search query (name/brand/category)
          schema:
            type: string
            example: "hoodie"
        - name: category
          in: query
          schema:
            type: string
            example: "outerwear"
        - name: brand
          in: query
          schema:
            type: string
            example: "Northwind"
        - name: size
          in: query
          schema:
            type: string
            example: "M"
        - name: color
          in: query
          schema:
            type: string
            example: "black"
        - name: minPrice
          in: query
          schema:
            type: number
            format: float
            minimum: 0
            example: 25.00
        - name: maxPrice
          in: query
          schema:
            type: number
            format: float
            minimum: 0
            example: 150.00
        - name: sort
          in: query
          description: Sorting option
          schema:
            type: string
            enum: [relevance, price_asc, price_desc, newest]
            default: relevance
      responses:
        "200":
          description: Product list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductListResponse"

  /products/{productId}:
    get:
      tags: [Products]
      summary: Get product details
      parameters:
        - $ref: "#/components/parameters/ProductId"
      responses:
        "200":
          description: Product details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Product"
        "404":
          $ref: "#/components/responses/NotFound"

  /categories:
    get:
      tags: [Catalog]
      summary: List categories
      description: Returns a list of product categories.
      responses:
        "200":
          description: Category list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CategoryListResponse"

  /brands:
    get:
      tags: [Catalog]
      summary: List brands
      description: Returns a list of brands.
      responses:
        "200":
          description: Brand list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BrandListResponse"

  /cart:
    get:
      tags: [Cart]
      summary: Get current cart
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Cart details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      tags: [Cart]
      summary: Add item to cart
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddToCartRequest"
      responses:
        "200":
          description: Updated cart
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "409":
          description: Not enough stock for requested quantity
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      tags: [Cart]
      summary: Clear cart
      security:
        - bearerAuth: []
      responses:
        "204":
          description: Cart cleared
        "401":
          $ref: "#/components/responses/Unauthorized"

  /cart/items/{sku}:
    patch:
      tags: [Cart]
      summary: Update cart item quantity
      description: Updates quantity for a cart item by SKU. Set quantity to 0 to remove the item.
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/Sku"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateCartItemRequest"
            examples:
              increaseQty:
                value:
                  quantity: 2
      responses:
        "200":
          description: Updated cart
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Not enough stock for requested quantity
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /checkout:
    post:
      tags: [Checkout]
      summary: Create checkout session
      description: Validates cart, creates a checkout session (shipping + payment intent placeholder).
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CheckoutRequest"
      responses:
        "201":
          description: Checkout session created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CheckoutSession"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "409":
          description: Stock conflict (one or more items unavailable)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /orders:
    get:
      tags: [Orders]
      summary: List my orders
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/Limit"
      responses:
        "200":
          description: Orders list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /orders/{orderId}:
    get:
      tags: [Orders]
      summary: Get order details
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/OrderId"
      responses:
        "200":
          description: Order details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /webhooks/payment-confirmed:
    post:
      tags: [Webhooks]
      summary: Payment confirmed webhook
      description: >
        Webhook called by payment provider when payment is confirmed.
        Secured with a signature header (sample).
      parameters:
        - $ref: "#/components/parameters/WebhookSignature"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PaymentConfirmedEvent"
            examples:
              Payload Example:
                value:
                  id: "evt_123"
                  type: "payment.confirmed"
                  createdAt: "2026-02-04T10:20:00Z"
                  data:
                    provider: "stripe"
                    paymentId: "pi_123"
                    orderId: "ord_9001"
                    amount:
                      amount: 138.99
                      currency: "EUR"
      responses:
        "204":
          description: Accepted (no content)
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          description: Invalid signature
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    Page:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
    Limit:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
    ProductId:
      name: productId
      in: path
      required: true
      schema:
        type: string
        example: "prod_1001"
    OrderId:
      name: orderId
      in: path
      required: true
      schema:
        type: string
        example: "ord_9001"
    Sku:
      name: sku
      in: path
      required: true
      schema:
        type: string
        example: "NW-HOODIE-BLK-M"
    WebhookSignature:
      name: X-Webhook-Signature
      in: header
      required: true
      description: HMAC signature of the raw request body (sample).
      schema:
        type: string
        example: "t=1707042000,v1=8b7f..."

  responses:
    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          examples:
            badRequest:
              value:
                code: "bad_request"
                message: "Validation failed"
                details:
                  - field: "items[0].sku"
                    issue: "must not be empty"
    Unauthorized:
      description: Missing or invalid access token
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          examples:
            unauthorized:
              value:
                code: "unauthorized"
                message: "Invalid or missing token"
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          examples:
            notFound:
              value:
                code: "not_found"
                message: "Resource not found"

  schemas:
    # --- Common ---
    Money:
      type: object
      required: [amount, currency]
      properties:
        amount:
          type: number
          format: float
          example: 59.99
        currency:
          type: string
          example: EUR

    ErrorDetail:
      type: object
      properties:
        field:
          type: string
          example: "shippingAddress.postalCode"
        issue:
          type: string
          example: "must match format"

    Error:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
          example: "bad_request"
        message:
          type: string
          example: "Validation failed"
        details:
          type: array
          items:
            $ref: "#/components/schemas/ErrorDetail"

    # --- Auth ---
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
          example: "user@example.com"
        password:
          type: string
          format: password
          example: "CorrectHorseBatteryStaple!"

    AuthToken:
      type: object
      required: [accessToken, tokenType, expiresIn]
      properties:
        accessToken:
          type: string
          description: JWT access token (sample)
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        tokenType:
          type: string
          example: "Bearer"
        expiresIn:
          type: integer
          description: Token lifetime in seconds
          example: 3600

    # --- Catalog / Products ---
    Category:
      type: object
      required: [id, name, slug]
      properties:
        id:
          type: string
          example: "cat_outerwear"
        name:
          type: string
          example: "Outerwear"
        slug:
          type: string
          example: "outerwear"

    CategoryListResponse:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Category"

    Brand:
      type: object
      required: [id, name]
      properties:
        id:
          type: string
          example: "brand_northwind"
        name:
          type: string
          example: "Northwind"

    BrandListResponse:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Brand"

    ProductVariant:
      type: object
      required: [sku, size, color, stock]
      properties:
        sku:
          type: string
          example: "NW-HOODIE-BLK-M"
        size:
          type: string
          example: "M"
        color:
          type: string
          example: "black"
        stock:
          type: integer
          minimum: 0
          example: 12

    Product:
      type: object
      required: [id, name, brand, category, price, images, variants]
      properties:
        id:
          type: string
          example: "prod_1001"
        name:
          type: string
          example: "Classic Hoodie"
        brand:
          type: string
          example: "Northwind"
        category:
          type: string
          example: "outerwear"
        description:
          type: string
          example: "Soft cotton hoodie with a classic fit."
        price:
          $ref: "#/components/schemas/Money"
        images:
          type: array
          items:
            type: string
            format: uri
        variants:
          type: array
          items:
            $ref: "#/components/schemas/ProductVariant"

    ProductListResponse:
      type: object
      required: [page, limit, total, items]
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        total:
          type: integer
          example: 120
        items:
          type: array
          items:
            $ref: "#/components/schemas/Product"

    # --- Cart ---
    CartItem:
      type: object
      required: [sku, productId, name, unitPrice, quantity]
      properties:
        sku:
          type: string
          example: "NW-HOODIE-BLK-M"
        productId:
          type: string
          example: "prod_1001"
        name:
          type: string
          example: "Classic Hoodie"
        unitPrice:
          $ref: "#/components/schemas/Money"
        quantity:
          type: integer
          minimum: 1
          example: 2

    Cart:
      type: object
      required: [id, items, subtotal, totalItems]
      properties:
        id:
          type: string
          example: "cart_abc123"
        items:
          type: array
          items:
            $ref: "#/components/schemas/CartItem"
        subtotal:
          $ref: "#/components/schemas/Money"
        totalItems:
          type: integer
          example: 3

    AddToCartRequest:
      type: object
      required: [sku, quantity]
      properties:
        sku:
          type: string
          example: "NW-HOODIE-BLK-M"
        quantity:
          type: integer
          minimum: 1
          example: 1

    UpdateCartItemRequest:
      type: object
      required: [quantity]
      properties:
        quantity:
          type: integer
          minimum: 0
          example: 2

    # --- Checkout / Orders ---
    Address:
      type: object
      required: [fullName, line1, city, country, postalCode]
      properties:
        fullName:
          type: string
          example: "John Doe"
        line1:
          type: string
          example: "Stret 10"
        line2:
          type: string
          example: "Apt 2B"
        city:
          type: string
          example: "Rome"
        state:
          type: string
          example: "RM"
        country:
          type: string
          example: "IT"
        postalCode:
          type: string
          example: "00100"
        phone:
          type: string
          example: "+39 543 857 344"

    CheckoutRequest:
      type: object
      required: [shippingAddress, paymentMethod]
      properties:
        shippingAddress:
          $ref: "#/components/schemas/Address"
        paymentMethod:
          type: string
          description: Payment method identifier (e.g., token/id)
          example: "pm_card_visa"

    OrderPreview:
      type: object
      required: [items, subtotal, shipping, total]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/CartItem"
        subtotal:
          $ref: "#/components/schemas/Money"
        shipping:
          $ref: "#/components/schemas/Money"
        total:
          $ref: "#/components/schemas/Money"

    CheckoutSession:
      type: object
      required: [id, status, orderPreview, payment]
      properties:
        id:
          type: string
          example: "chk_001"
        status:
          type: string
          enum: [created, confirmed, failed]
          example: created
        orderPreview:
          $ref: "#/components/schemas/OrderPreview"
        payment:
          type: object
          required: [provider, clientSecret]
          properties:
            provider:
              type: string
              example: "stripe"
            clientSecret:
              type: string
              example: "pi_123_secret_456"

    Order:
      type: object
      required: [id, status, createdAt, items, totals, shippingAddress]
      properties:
        id:
          type: string
          example: "ord_9001"
        status:
          type: string
          enum: [pending, paid, shipped, delivered, cancelled, refunded]
          example: paid
        createdAt:
          type: string
          format: date-time
          example: "2026-02-04T10:20:00Z"
        items:
          type: array
          items:
            $ref: "#/components/schemas/CartItem"
        totals:
          type: object
          required: [subtotal, shipping, total]
          properties:
            subtotal:
              $ref: "#/components/schemas/Money"
            shipping:
              $ref: "#/components/schemas/Money"
            total:
              $ref: "#/components/schemas/Money"
        shippingAddress:
          $ref: "#/components/schemas/Address"

    OrderListResponse:
      type: object
      required: [page, limit, total, items]
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        total:
          type: integer
          example: 4
        items:
          type: array
          items:
            $ref: "#/components/schemas/Order"

    # --- Webhooks ---
    PaymentConfirmedEvent:
      type: object
      required: [id, type, createdAt, data]
      properties:
        id:
          type: string
          example: "evt_123"
        type:
          type: string
          example: "payment.confirmed"
        createdAt:
          type: string
          format: date-time
          example: "2026-02-04T10:20:00Z"
        data:
          type: object
          required: [provider, paymentId, orderId, amount]
          properties:
            provider:
              type: string
              example: "stripe"
            paymentId:
              type: string
              example: "pi_123"
            orderId:
              type: string
              example: "ord_9001"
            amount:
              $ref: "#/components/schemas/Money"
